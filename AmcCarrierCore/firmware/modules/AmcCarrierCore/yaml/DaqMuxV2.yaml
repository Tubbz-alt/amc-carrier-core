##############################################################################
## This file is part of 'SLAC Firmware Standard Library'.
## It is subject to the license terms in the LICENSE.txt file found in the
## top-level directory of this distribution and at:
##    https://confluence.slac.stanford.edu/display/ppareg/LICENSE.html.
## No part of 'SLAC Firmware Standard Library', including this file,
## may be copied, modified, propagated, or distributed except according to
## the terms contained in the LICENSE.txt file.
##############################################################################

DaqMux: &DaqMuxV2
  name: DaqMuxV2
  description: Waveform Data Acquisition Module
  size: 0x1000
  
  metadata:
    - numBuffers: &numOutPorts 4
  
  registers:
    #########################################################
    - address: 0x000
      name: TriggerSw
      sizeBits: 1
      lsBit: 0
      mode: RW
      description: "Software Trigger (triggers DAQ on all enabled channels)."
    #########################################################
    - address: 0x000
      name: TriggerCascMask
      sizeBits: 1
      lsBit: 1
      mode: RW
      enums:
        - name: Disabled
          value: 0
        - name: Enabled 
          value: 1
      description: "Mask for enabling/disabling cascaded trigger."
    #########################################################
    - address: 0x000
      name: TriggerHwAutoRearm
      sizeBits: 1
      lsBit: 2
      mode: RW
      enums:
        - name: Disabled
          value: 0
        - name: Enabled 
          value: 1
      description: "Mask for enabling/disabling hardware trigger. If disabled it has to be rearmed by ArmHwTrigger."
    #########################################################
    - address: 0x000
      name: TriggerHwArm
      sizeBits: 1
      lsBit: 3
      mode: RW
      description: "Arm the Hardware trigger (On the rising edge). After trigger occurs the trigger has to be rearmed."
    #########################################################
    - address: 0x000
      name: TriggerClearStatus
      sizeBits: 1
      lsBit: 4
      mode: RW
      description: "Trigger status will be cleared (On the rising edge)."
    #########################################################
    - address: 0x000
      name: DaqMode
      sizeBits: 1
      lsBit: 5
      mode: RW
      enums:
        - name: TriggeredMode
          value: 0
        - name: ContinuousMode 
          value: 1
      description: "Select the data ackuisition mode."
    #########################################################
    - address: 0x000
      name: PacketHeaderEn
      sizeBits: 1
      lsBit: 6
      mode: RW
      enums:
        - name: Disabled
          value: 0
        - name: Enabled 
          value: 1
      description: "Applies only to Triggered mode."   
    #########################################################
    - address: 0x000
      name: FreezeSw
      sizeBits: 1
      lsBit: 7
      mode: RW
      description: "Software freeze buffer (Freezes all enabled circular buffers)."
    #########################################################
    - address: 0x000
      name: FreezeHwMask
      sizeBits: 1
      lsBit: 8
      mode: RW
      enums:
        - name: Disabled
          value: 0
        - name: Enabled 
          value: 1
      description: "Mask for enabling/disabling hardware freaze buffer request."   
    #########################################################
    - address: 0x004
      name: TriggerSwStatus
      sizeBits: 1
      lsBit: 0
      mode: RO
      description: "Software Trigger Status (Registered on first trigger until cleared by TriggerClearStatus)."
    #########################################################
    - address: 0x004
      name: TriggerCascStatus
      sizeBits: 1
      lsBit: 1
      mode: RO
      description: "Cascade Trigger Status (Registered on first trigger until cleared by TriggerClearStatus)."
    #########################################################
    - address: 0x004
      name: TriggerHwStatus
      sizeBits: 1
      lsBit: 2
      mode: RO
      description: "Hardware Trigger Status (Registered on first trigger until cleared by TriggerClearStatus)."
    #########################################################
    - address: 0x004
      name: TriggerHwArmed
      sizeBits: 1
      lsBit: 3
      mode: RO
      description: "Hardware Trigger Armed Status (Registered on rising edge Control(3) and cleared when Hw trigger occurs)."
    #########################################################
    - address: 0x004
      name: TriggerStatus
      sizeBits: 1
      lsBit: 4
      mode: RO
      description: "Combined Trigger Status (Registered on first trigger until cleared by TriggerClearStatus)."
    #########################################################    
    - address: 0x004
      name: FreezeStatus
      sizeBits: 1
      lsBit: 5
      mode: RO
      description: "Freeze Buffers Status (Registered on first freeze until cleared by TriggerClearStatus)"
    #########################################################      
    - address: 0x008
      name: DecimationRateDiv
      sizeBits: 16
      mode: RW
      description: "Averaging Enabled: (powers of two) 1,2,4,8,16,etc (max 2^12). Averaging Disabled (32-bit): 1,2,3,4,etc (max 2^16-1). Averaging Disabled (16-bit): 1,2,4,6,8,etc (max 2^16-1)."
    #########################################################
    - address: 0x00C
      name: DataBufferSize
      sizeBits: 32
      mode: RW
      description:"Number of 32-bit words. Minimum size is 4."
    #########################################################
    - address: 0x040
      name: InputMuxSel
      sizeBits: 5
      stride: 4
      nelms: &numOutPorts
      mode: RW
      enums:
        - name: Disabled
          value: 0
        - name: Test
          value: 1          
        - name: Ch0
          value: 2
        - name: Ch1
          value: 3
        - name: Ch2
          value: 4
        - name: Ch3
          value: 5
        - name: Ch4
          value: 6
        - name: Ch5
          value: 7
        - name: Ch6
          value: 8
        - name: Ch7
          value: 9
        - name: Ch8
          value: 10
        - name: Ch9
          value: 11
        - name: Ch10
          value: 12
        - name: Ch11
          value: 13
        - name: Ch12
          value: 14
        - name: Ch13
          value: 15
        - name: Ch14
          value: 16
        - name: Ch15
          value: 17
        - name: Ch16
          value: 18
        - name: Ch17
          value: 19
        - name: Ch18
          value: 20
        - name: Ch19
          value: 21
        - name: Ch20
          value: 22
        - name: Ch21
          value: 23
        - name: Ch22
          value: 24
        - name: Ch23
          value: 25
        - name: Ch24
          value: 26
        - name: Ch25
          value: 27
        - name: Ch26
          value: 28
        - name: Ch27
          value: 29
        - name: Ch28
          value: 30
        - name: Ch29
          value: 31     
      description: "Input Mux select. Maximum number of channels is 29."
    #########################################################
    - address: 0x080
      name: StreamPause
      sizeBits: 1
      stride: 4
      nelms: &numOutPorts
      mode: RO
      description: "Raw diagnostic stream control Pause."
    #########################################################
    - address: 0x080
      name: StreamReady
      sizeBits: 1
      lsBit: 1
      stride: 4
      nelms: &numOutPorts
      mode: RO
      description: "Raw diagnostic stream control Ready."
    #########################################################
    - address: 0x080
      name: StreamOverflow
      sizeBits: 1
      lsBit: 2
      stride: 4
      nelms: &numOutPorts
      mode: RO
      description: "Raw diagnostic stream control Overflow."
    #########################################################
    - address: 0x080
      name: StreamError
      sizeBits: 1
      lsBit: 3
      stride: 4
      nelms: &numOutPorts
      mode: RO
      description: "Error during last Acquisition (Raw diagnostic stream control Ready or incoming data valid dropped)."
    #########################################################
    - address: 0x080
      name: InputDataValid
      sizeBits: 1
      lsBit: 4
      stride: 4
      nelms: &numOutPorts
      mode: RO
      description: "The incoming data is Valid (Usually connected to JESD valid signal)."
    #########################################################
    - address: 0x080
      name: StreamEnabled
      sizeBits: 1
      lsBit: 5
      stride: 4
      nelms: &numOutPorts
      mode: RO
      description: "Output stream enabled."
    #########################################################
    - address: 0x080
      name: FrameCnt
      sizeBits: 26
      lsBit: 6
      stride: 4
      nelms: &numOutPorts
      mode: RO
      description: "Number of 4096 byte frames sent."
    #########################################################
    - address: 0x0C0
      name: FormatSignWidth
      sizeBits: 5
      stride: 4
      nelms: &numOutPorts
      mode: RW
      hidden: true
      description: "Indicating sign extension point."
    #########################################################
    - address: 0x0C0
      name: FormatDataWidth
      sizeBits: 1
      lsBit: 5
      stride: 4
      nelms: &numOutPorts
      mode: RW
      enums: 
        - name: D32-bit
          value: 0
        - name: D16-bit
          value: 1
      description: "Data width 32-bit or 16-bit."
    #########################################################
    - address: 0x0C0
      name: FormatSign
      sizeBits: 1
      lsBit: 6
      stride: 4
      nelms: &numOutPorts
      mode: RW
      enums: 
        - name: Unsigned
          value: 0
        - name: Signed
          value: 1
      hidden: true
      description: "Sign format."
    #########################################################
    - address: 0x0C0
      name: DecimationAveraging
      sizeBits: 1
      lsBit: 7
      stride: 4
      nelms: &numOutPorts
      mode: RW
      enums: 
        - name: Disabled
          value: 0
        - name: Enabled
          value: 1
      description: "Decimation Averaging."
    #########################################################
  #########
  Commands:
  #########
    - name: TriggerDaq
      description: "Trigger data aquisition from software."
      sequence:
        - entry: TriggerSw
          value: 0x1
        - entry: TriggerSw
          value: 0x0               
    #########################################################
    - name: ArmHwTrigger
      description: "Arm Hardware Trigger."
      sequence:
        - entry: ArmHwTrigger
          value: 0x1
        - entry: ArmHwTrigger
          value: 0x0               
    #########################################################
    - name: FreezeBuffers
      description: "Freeze circular buffers from software."
        - entry: FreezeSw
          value: 0x1
        - entry: FreezeSw
          value: 0x0               
    #########################################################